<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Medical Chatbot</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container mt-4">
    <!-- Header with logo -->
    <div class="chat-header d-flex align-items-center mb-3">
        <img src="{{ url_for('static', filename='medical_logo.png') }}" alt="Logo" class="header-logo me-2">
        <h4 class="mb-0">Medical Chatbot</h4>
    </div>

    <!-- Chat card -->
    <div class="chat-card card p-3">
        <div id="chat-box"></div>
        <div id="typing-indicator" class="d-none">
            <img src="{{ url_for('static', filename='bot.png') }}" class="avatar">
            <span>Bot is typing...</span>
        </div>
        <div class="input-group mt-3">
            <input type="text" class="form-control" id="user-input" placeholder="Type your message...">
            <button class="btn btn-primary" id="send-btn">Send</button>
        </div>
    </div>
</div>

<script>
const chatBox = document.getElementById("chat-box");
const userInput = document.getElementById("user-input");
const sendBtn = document.getElementById("send-btn");
const typingIndicator = document.getElementById("typing-indicator");

function addMessage(message, sender="user") {
    const div = document.createElement("div");
    div.classList.add(sender === "user" ? "user-message" : "bot-message", "d-flex", "align-items-start", "mb-2");

    const img = document.createElement("img");
    img.classList.add("avatar", "me-2");
    img.src = sender === "user" ? "{{ url_for('static', filename='medical_logo.png') }}" : "{{ url_for('static', filename='bot.png') }}";

    const span = document.createElement("span");
    span.classList.add("badge");
    span.textContent = message;

    div.appendChild(img);
    div.appendChild(span);
    chatBox.appendChild(div);
    chatBox.scrollTop = chatBox.scrollHeight;
}

sendBtn.addEventListener("click", async () => {
    const msg = userInput.value.trim();
    if (!msg) return;
    addMessage(msg, "user");
    userInput.value = "";

    typingIndicator.classList.remove("d-none");

    try {
        const res = await fetch("/get", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message: msg })
        });
        const data = await res.json();
        typingIndicator.classList.add("d-none");
        addMessage(data.answer, "bot");
    } catch (err) {
        typingIndicator.classList.add("d-none");
        addMessage("Error: Could not reach server.", "bot");
    }
});

userInput.addEventListener("keypress", function(e){
    if(e.key === "Enter") sendBtn.click();
});
</script>
</body>
</html>